import { useEffect, useState } from 'react';

type FacingDirection = 'north' | 'south' | 'east' | 'west';

interface PixelCharacterProps {
  direction: FacingDirection;
  isMoving: boolean;
  size: number;
  userColor: string;
}

// Convert hex to RGB for color manipulation
const hexToRgb = (hex: string) => {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : { r: 100, g: 100, b: 200 };
};

// Darken a color for shading
const darkenColor = (hex: string, amount: number = 0.3) => {
  const rgb = hexToRgb(hex);
  const r = Math.max(0, Math.floor(rgb.r * (1 - amount)));
  const g = Math.max(0, Math.floor(rgb.g * (1 - amount)));
  const b = Math.max(0, Math.floor(rgb.b * (1 - amount)));
  return `rgb(${r},${g},${b})`;
};

const PixelCharacter = ({ direction, isMoving, size, userColor }: PixelCharacterProps) => {
  const [frame, setFrame] = useState(0);

  useEffect(() => {
    if (!isMoving) {
      setFrame(0);
      return;
    }

    const interval = setInterval(() => {
      setFrame(prev => (prev + 1) % 4);
    }, 120);

    return () => clearInterval(interval);
  }, [isMoving]);

  const scale = Math.max(0.6, size / 28);
  const pixelSize = Math.max(1, Math.floor(1.5 * scale));
  
  // Sprite dimensions: 16 wide x 24 tall (1x2 tiles)
  const spriteWidth = 16;
  const spriteHeight = 24;

  // Color palette
  // 0 = transparent
  // 1 = skin
  // 2 = skin shadow
  // 3 = hair
  // 4 = hair highlight
  // 5 = hair shadow
  // 6 = shirt (user color)
  // 7 = shirt shadow
  // 8 = pants
  // 9 = pants shadow
  // 10 = shoes
  // 11 = eyes
  // 12 = eye white
  // 13 = outline

  const shirtColor = userColor;
  const shirtShadow = darkenColor(userColor, 0.35);

  const colors: Record<number, string> = {
    0: 'transparent',
    1: '#f8d8b0',    // skin
    2: '#d4a574',    // skin shadow
    3: '#5c3d2e',    // hair
    4: '#7a5540',    // hair highlight
    5: '#3d2517',    // hair shadow
    6: shirtColor,   // shirt
    7: shirtShadow,  // shirt shadow
    8: '#4a6fa5',    // pants
    9: '#364f73',    // pants shadow
    10: '#3d2517',   // shoes
    11: '#1a1a2e',   // eyes
    12: '#ffffff',   // eye whites
    13: '#2d1f1a',   // outline
  };

  // More detailed 16x24 sprites for Stardew-like character
  const sprites: Record<FacingDirection, number[][][]> = {
    south: [
      // Frame 0 - standing
      [
        [0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0],
        [0,0,0,0,3,3,4,4,4,4,3,3,0,0,0,0],
        [0,0,0,3,3,4,4,4,4,4,4,3,3,0,0,0],
        [0,0,0,3,5,3,3,3,3,3,3,5,3,0,0,0],
        [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
        [0,0,1,1,12,11,1,1,1,12,11,1,1,0,0,0],
        [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
        [0,0,0,1,1,1,2,1,1,2,1,1,1,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0],
        [0,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0],
        [0,0,1,6,6,6,6,6,6,6,6,6,6,1,0,0],
        [0,0,1,6,7,7,6,6,6,6,7,7,6,1,0,0],
        [0,0,0,6,7,7,7,6,6,7,7,7,6,0,0,0],
        [0,0,0,6,6,7,7,6,6,7,7,6,6,0,0,0],
        [0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
        [0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,8,9,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,8,9,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,8,9,8,0,0,0,0],
        [0,0,0,0,10,10,10,0,0,10,10,10,0,0,0,0],
        [0,0,0,0,10,13,10,0,0,10,13,10,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
      // Frame 1 - walk left
      [
        [0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0],
        [0,0,0,0,3,3,4,4,4,4,3,3,0,0,0,0],
        [0,0,0,3,3,4,4,4,4,4,4,3,3,0,0,0],
        [0,0,0,3,5,3,3,3,3,3,3,5,3,0,0,0],
        [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
        [0,0,1,1,12,11,1,1,1,12,11,1,1,0,0,0],
        [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
        [0,0,0,1,1,1,2,1,1,2,1,1,1,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0],
        [0,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0],
        [0,0,1,6,6,6,6,6,6,6,6,6,6,1,0,0],
        [0,0,1,6,7,7,6,6,6,6,7,7,6,1,0,0],
        [0,0,0,6,7,7,7,6,6,7,7,7,6,0,0,0],
        [0,0,0,6,6,7,7,6,6,7,7,6,6,0,0,0],
        [0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
        [0,0,0,0,0,8,8,8,8,8,8,0,0,0,0,0],
        [0,0,0,8,8,9,8,0,0,8,8,0,0,0,0,0],
        [0,0,0,8,9,9,0,0,0,0,8,8,0,0,0,0],
        [0,0,10,10,10,0,0,0,0,0,8,9,0,0,0,0],
        [0,0,10,13,0,0,0,0,0,0,10,10,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,10,13,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
      // Frame 2 - standing
      [
        [0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0],
        [0,0,0,0,3,3,4,4,4,4,3,3,0,0,0,0],
        [0,0,0,3,3,4,4,4,4,4,4,3,3,0,0,0],
        [0,0,0,3,5,3,3,3,3,3,3,5,3,0,0,0],
        [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
        [0,0,1,1,12,11,1,1,1,12,11,1,1,0,0,0],
        [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
        [0,0,0,1,1,1,2,1,1,2,1,1,1,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0],
        [0,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0],
        [0,0,1,6,6,6,6,6,6,6,6,6,6,1,0,0],
        [0,0,1,6,7,7,6,6,6,6,7,7,6,1,0,0],
        [0,0,0,6,7,7,7,6,6,7,7,7,6,0,0,0],
        [0,0,0,6,6,7,7,6,6,7,7,6,6,0,0,0],
        [0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
        [0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,8,9,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,8,9,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,8,9,8,0,0,0,0],
        [0,0,0,0,10,10,10,0,0,10,10,10,0,0,0,0],
        [0,0,0,0,10,13,10,0,0,10,13,10,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
      // Frame 3 - walk right
      [
        [0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0],
        [0,0,0,0,3,3,4,4,4,4,3,3,0,0,0,0],
        [0,0,0,3,3,4,4,4,4,4,4,3,3,0,0,0],
        [0,0,0,3,5,3,3,3,3,3,3,5,3,0,0,0],
        [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
        [0,0,1,1,12,11,1,1,1,12,11,1,1,0,0,0],
        [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
        [0,0,0,1,1,1,2,1,1,2,1,1,1,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0],
        [0,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0],
        [0,0,1,6,6,6,6,6,6,6,6,6,6,1,0,0],
        [0,0,1,6,7,7,6,6,6,6,7,7,6,1,0,0],
        [0,0,0,6,7,7,7,6,6,7,7,7,6,0,0,0],
        [0,0,0,6,6,7,7,6,6,7,7,6,6,0,0,0],
        [0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
        [0,0,0,0,0,8,8,8,8,8,8,0,0,0,0,0],
        [0,0,0,0,0,8,8,0,0,8,9,8,8,0,0,0],
        [0,0,0,0,8,8,0,0,0,0,9,9,8,0,0,0],
        [0,0,0,0,9,8,0,0,0,0,10,10,10,0,0,0],
        [0,0,0,0,10,10,0,0,0,0,0,13,10,0,0,0],
        [0,0,0,0,13,10,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
    ],
    north: [
      // Frame 0 - standing (back)
      [
        [0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0],
        [0,0,0,0,3,5,3,3,3,3,5,3,0,0,0,0],
        [0,0,0,3,5,5,5,5,5,5,5,5,3,0,0,0],
        [0,0,0,3,5,5,5,5,5,5,5,5,3,0,0,0],
        [0,0,0,3,5,5,5,5,5,5,5,5,3,0,0,0],
        [0,0,0,1,1,5,5,5,5,5,5,1,1,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0],
        [0,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0],
        [0,0,1,6,6,7,7,6,6,7,7,6,6,1,0,0],
        [0,0,1,6,7,7,7,6,6,7,7,7,6,1,0,0],
        [0,0,0,6,7,7,7,6,6,7,7,7,6,0,0,0],
        [0,0,0,6,6,7,7,6,6,7,7,6,6,0,0,0],
        [0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
        [0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,8,9,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,8,9,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,8,9,8,0,0,0,0],
        [0,0,0,0,10,10,10,0,0,10,10,10,0,0,0,0],
        [0,0,0,0,10,13,10,0,0,10,13,10,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
      // Frame 1
      [
        [0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0],
        [0,0,0,0,3,5,3,3,3,3,5,3,0,0,0,0],
        [0,0,0,3,5,5,5,5,5,5,5,5,3,0,0,0],
        [0,0,0,3,5,5,5,5,5,5,5,5,3,0,0,0],
        [0,0,0,3,5,5,5,5,5,5,5,5,3,0,0,0],
        [0,0,0,1,1,5,5,5,5,5,5,1,1,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0],
        [0,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0],
        [0,0,1,6,6,7,7,6,6,7,7,6,6,1,0,0],
        [0,0,1,6,7,7,7,6,6,7,7,7,6,1,0,0],
        [0,0,0,6,7,7,7,6,6,7,7,7,6,0,0,0],
        [0,0,0,6,6,7,7,6,6,7,7,6,6,0,0,0],
        [0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
        [0,0,0,0,0,8,8,8,8,8,8,0,0,0,0,0],
        [0,0,0,8,8,9,8,0,0,8,8,0,0,0,0,0],
        [0,0,0,8,9,9,0,0,0,0,8,8,0,0,0,0],
        [0,0,10,10,10,0,0,0,0,0,8,9,0,0,0,0],
        [0,0,10,13,0,0,0,0,0,0,10,10,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,10,13,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
      // Frame 2
      [
        [0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0],
        [0,0,0,0,3,5,3,3,3,3,5,3,0,0,0,0],
        [0,0,0,3,5,5,5,5,5,5,5,5,3,0,0,0],
        [0,0,0,3,5,5,5,5,5,5,5,5,3,0,0,0],
        [0,0,0,3,5,5,5,5,5,5,5,5,3,0,0,0],
        [0,0,0,1,1,5,5,5,5,5,5,1,1,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0],
        [0,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0],
        [0,0,1,6,6,7,7,6,6,7,7,6,6,1,0,0],
        [0,0,1,6,7,7,7,6,6,7,7,7,6,1,0,0],
        [0,0,0,6,7,7,7,6,6,7,7,7,6,0,0,0],
        [0,0,0,6,6,7,7,6,6,7,7,6,6,0,0,0],
        [0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
        [0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,8,9,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,8,9,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,8,9,8,0,0,0,0],
        [0,0,0,0,10,10,10,0,0,10,10,10,0,0,0,0],
        [0,0,0,0,10,13,10,0,0,10,13,10,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
      // Frame 3
      [
        [0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0],
        [0,0,0,0,3,5,3,3,3,3,5,3,0,0,0,0],
        [0,0,0,3,5,5,5,5,5,5,5,5,3,0,0,0],
        [0,0,0,3,5,5,5,5,5,5,5,5,3,0,0,0],
        [0,0,0,3,5,5,5,5,5,5,5,5,3,0,0,0],
        [0,0,0,1,1,5,5,5,5,5,5,1,1,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0],
        [0,0,0,6,6,6,6,6,6,6,6,6,6,0,0,0],
        [0,0,1,6,6,7,7,6,6,7,7,6,6,1,0,0],
        [0,0,1,6,7,7,7,6,6,7,7,7,6,1,0,0],
        [0,0,0,6,7,7,7,6,6,7,7,7,6,0,0,0],
        [0,0,0,6,6,7,7,6,6,7,7,6,6,0,0,0],
        [0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0],
        [0,0,0,0,0,8,8,8,8,8,8,0,0,0,0,0],
        [0,0,0,0,0,8,8,0,0,8,9,8,8,0,0,0],
        [0,0,0,0,8,8,0,0,0,0,9,9,8,0,0,0],
        [0,0,0,0,9,8,0,0,0,0,10,10,10,0,0,0],
        [0,0,0,0,10,10,0,0,0,0,0,13,10,0,0,0],
        [0,0,0,0,13,10,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
    ],
    east: [
      // Frame 0 - standing (right)
      [
        [0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0],
        [0,0,0,0,0,3,3,4,4,3,3,0,0,0,0,0],
        [0,0,0,0,3,3,4,4,4,4,3,0,0,0,0,0],
        [0,0,0,0,3,5,3,3,3,3,3,0,0,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,1,1,1,12,11,1,1,0,0,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,1,1,1,2,1,0,0,0,0,0,0],
        [0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,0,0,0,0,0,0],
        [0,0,0,0,6,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,1,6,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,1,6,6,6,6,6,6,6,1,0,0,0,0],
        [0,0,0,0,6,7,7,6,6,7,6,1,0,0,0,0],
        [0,0,0,0,6,7,7,7,6,6,6,0,0,0,0,0],
        [0,0,0,0,0,6,7,7,6,6,0,0,0,0,0,0],
        [0,0,0,0,0,8,8,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,8,8,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,8,9,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,8,9,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,8,9,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,10,10,10,10,10,0,0,0,0,0,0],
        [0,0,0,0,0,10,13,10,10,13,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
      // Frame 1
      [
        [0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0],
        [0,0,0,0,0,3,3,4,4,3,3,0,0,0,0,0],
        [0,0,0,0,3,3,4,4,4,4,3,0,0,0,0,0],
        [0,0,0,0,3,5,3,3,3,3,3,0,0,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,1,1,1,12,11,1,1,0,0,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,1,1,1,2,1,0,0,0,0,0,0],
        [0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,0,0,0,0,0,0],
        [0,0,0,0,6,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,1,6,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,1,6,6,6,6,6,6,6,1,0,0,0,0],
        [0,0,0,0,6,7,7,6,6,7,6,1,0,0,0,0],
        [0,0,0,0,6,7,7,7,6,6,6,0,0,0,0,0],
        [0,0,0,0,0,6,7,7,6,6,0,0,0,0,0,0],
        [0,0,0,0,0,8,8,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,8,8,8,0,0,8,8,0,0,0,0,0],
        [0,0,0,8,9,8,0,0,0,0,8,8,0,0,0,0],
        [0,0,10,10,10,0,0,0,0,0,8,9,0,0,0,0],
        [0,0,10,13,0,0,0,0,0,0,10,10,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,10,13,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
      // Frame 2
      [
        [0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0],
        [0,0,0,0,0,3,3,4,4,3,3,0,0,0,0,0],
        [0,0,0,0,3,3,4,4,4,4,3,0,0,0,0,0],
        [0,0,0,0,3,5,3,3,3,3,3,0,0,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,1,1,1,12,11,1,1,0,0,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,1,1,1,2,1,0,0,0,0,0,0],
        [0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,0,0,0,0,0,0],
        [0,0,0,0,6,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,1,6,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,1,6,6,6,6,6,6,6,1,0,0,0,0],
        [0,0,0,0,6,7,7,6,6,7,6,1,0,0,0,0],
        [0,0,0,0,6,7,7,7,6,6,6,0,0,0,0,0],
        [0,0,0,0,0,6,7,7,6,6,0,0,0,0,0,0],
        [0,0,0,0,0,8,8,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,8,8,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,8,9,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,8,9,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,8,9,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,10,10,10,10,10,0,0,0,0,0,0],
        [0,0,0,0,0,10,13,10,10,13,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
      // Frame 3
      [
        [0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0],
        [0,0,0,0,0,3,3,4,4,3,3,0,0,0,0,0],
        [0,0,0,0,3,3,4,4,4,4,3,0,0,0,0,0],
        [0,0,0,0,3,5,3,3,3,3,3,0,0,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,1,1,1,12,11,1,1,0,0,0,0,0],
        [0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,1,1,1,2,1,0,0,0,0,0,0],
        [0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,0,0,0,0,0,0],
        [0,0,0,0,6,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,1,6,6,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,1,6,6,6,6,6,6,6,1,0,0,0,0],
        [0,0,0,0,6,7,7,6,6,7,6,1,0,0,0,0],
        [0,0,0,0,6,7,7,7,6,6,6,0,0,0,0,0],
        [0,0,0,0,0,6,7,7,6,6,0,0,0,0,0,0],
        [0,0,0,0,0,8,8,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,8,8,0,0,8,8,0,0,0,0,0],
        [0,0,0,0,8,8,0,0,0,0,8,9,0,0,0,0],
        [0,0,0,0,9,8,0,0,0,0,10,10,0,0,0,0],
        [0,0,0,0,10,10,0,0,0,0,10,13,0,0,0,0],
        [0,0,0,0,10,13,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
    ],
    west: [
      // Frame 0 - standing (left) - mirrored
      [
        [0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0],
        [0,0,0,0,0,3,3,4,4,3,3,0,0,0,0,0],
        [0,0,0,0,0,3,4,4,4,4,3,3,0,0,0,0],
        [0,0,0,0,0,3,3,3,3,3,5,3,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,1,1,11,12,1,1,1,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,0,1,2,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
        [0,0,0,0,0,0,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,6,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,6,1,0,0,0],
        [0,0,0,0,1,6,6,6,6,6,6,6,1,0,0,0],
        [0,0,0,0,1,6,7,6,6,7,7,6,0,0,0,0],
        [0,0,0,0,0,6,6,6,7,7,7,6,0,0,0,0],
        [0,0,0,0,0,0,6,6,7,7,6,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,8,8,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,8,8,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,9,8,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,9,8,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,9,8,0,0,0,0,0],
        [0,0,0,0,0,0,10,10,10,10,10,0,0,0,0,0],
        [0,0,0,0,0,0,13,10,10,13,10,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
      // Frame 1
      [
        [0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0],
        [0,0,0,0,0,3,3,4,4,3,3,0,0,0,0,0],
        [0,0,0,0,0,3,4,4,4,4,3,3,0,0,0,0],
        [0,0,0,0,0,3,3,3,3,3,5,3,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,1,1,11,12,1,1,1,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,0,1,2,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
        [0,0,0,0,0,0,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,6,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,6,1,0,0,0],
        [0,0,0,0,1,6,6,6,6,6,6,6,1,0,0,0],
        [0,0,0,0,1,6,7,6,6,7,7,6,0,0,0,0],
        [0,0,0,0,0,6,6,6,7,7,7,6,0,0,0,0],
        [0,0,0,0,0,0,6,6,7,7,6,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,8,8,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,8,8,0,0,8,8,8,0,0,0,0],
        [0,0,0,0,8,8,0,0,0,0,8,9,8,0,0,0],
        [0,0,0,0,9,8,0,0,0,0,10,10,10,0,0,0],
        [0,0,0,0,10,10,0,0,0,0,0,13,10,0,0,0],
        [0,0,0,0,13,10,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
      // Frame 2
      [
        [0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0],
        [0,0,0,0,0,3,3,4,4,3,3,0,0,0,0,0],
        [0,0,0,0,0,3,4,4,4,4,3,3,0,0,0,0],
        [0,0,0,0,0,3,3,3,3,3,5,3,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,1,1,11,12,1,1,1,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,0,1,2,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
        [0,0,0,0,0,0,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,6,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,6,1,0,0,0],
        [0,0,0,0,1,6,6,6,6,6,6,6,1,0,0,0],
        [0,0,0,0,1,6,7,6,6,7,7,6,0,0,0,0],
        [0,0,0,0,0,6,6,6,7,7,7,6,0,0,0,0],
        [0,0,0,0,0,0,6,6,7,7,6,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,8,8,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,8,8,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,9,8,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,9,8,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,9,8,0,0,0,0,0],
        [0,0,0,0,0,0,10,10,10,10,10,0,0,0,0,0],
        [0,0,0,0,0,0,13,10,10,13,10,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
      // Frame 3
      [
        [0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0],
        [0,0,0,0,0,3,3,4,4,3,3,0,0,0,0,0],
        [0,0,0,0,0,3,4,4,4,4,3,3,0,0,0,0],
        [0,0,0,0,0,3,3,3,3,3,5,3,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,1,1,11,12,1,1,1,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,0,0,1,2,1,1,1,0,0,0,0,0],
        [0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
        [0,0,0,0,0,0,6,6,6,6,6,0,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,6,0,0,0,0],
        [0,0,0,0,0,6,6,6,6,6,6,6,1,0,0,0],
        [0,0,0,0,1,6,6,6,6,6,6,6,1,0,0,0],
        [0,0,0,0,1,6,7,6,6,7,7,6,0,0,0,0],
        [0,0,0,0,0,6,6,6,7,7,7,6,0,0,0,0],
        [0,0,0,0,0,0,6,6,7,7,6,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,8,8,0,0,0,0,0],
        [0,0,0,0,0,0,8,8,8,8,0,0,0,0,0,0],
        [0,0,0,0,0,8,8,8,0,0,8,8,0,0,0,0],
        [0,0,0,0,8,9,8,0,0,0,0,8,8,0,0,0],
        [0,0,0,10,10,10,0,0,0,0,0,8,9,0,0,0],
        [0,0,0,10,13,0,0,0,0,0,0,10,10,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,10,13,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      ],
    ],
  };

  const currentSprite = sprites[direction][frame];

  return (
    <div 
      className="relative drop-shadow-lg pointer-events-none"
      style={{ 
        width: spriteWidth * pixelSize,
        height: spriteHeight * pixelSize,
        marginTop: -(spriteHeight * pixelSize - size), // Offset so feet align with tile
      }}
    >
      <svg 
        width={spriteWidth * pixelSize} 
        height={spriteHeight * pixelSize}
        style={{ imageRendering: 'pixelated' }}
      >
        {currentSprite.map((row, y) =>
          row.map((pixel, x) => (
            pixel !== 0 && (
              <rect
                key={`${x}-${y}`}
                x={x * pixelSize}
                y={y * pixelSize}
                width={pixelSize}
                height={pixelSize}
                fill={colors[pixel]}
              />
            )
          ))
        )}
      </svg>
    </div>
  );
};

export default PixelCharacter;